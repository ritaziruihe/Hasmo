import requests
from bs4 import BeautifulSoup
import json
import pandas as pd
from openpyxl.styles import Alignment, Border, Side, Font
from openpyxl import Workbook

def fetch_bcg_data():
    data2 = {
        "service_offerings": [],
        "case_studies": [],
        "client_testimonials": [],
        "thought_leadership": [],
        "market_insight": []
    }

    # BCG Service Offerings
    service_url2 = "https://www.bcg.com/capabilities"
    service_page2 = requests.get(service_url2)
    if service_page2.status_code == 200:
        service_soup2 = BeautifulSoup(service_page2.text, 'html.parser')
        service_section2 = service_soup2.find_all('p', class_="featured-collection__title")
        for service in service_section2:
            data2['service_offerings'].append(service.get_text().strip())

    # BCG Client Testimonials
    client_url2 = "https://www.bcg.com/capabilities/digital-technology-data/client-success"
    client_page2 = requests.get(client_url2)
    if client_page2.status_code == 200:
        client_soup2 = BeautifulSoup(client_page2.text, 'html.parser')
        client_section2 = client_soup2.find_all('div', class_="article-block__body")
        for testimonies in client_section2:
            data2["client_testimonials"].append(testimonies.get_text().strip())

    # BCG Thought Leadership
    leadership_url2 = "https://www.bcg.com/capabilities/business-transformation/insights"
    leadership_page2 = requests.get(leadership_url2)
    if leadership_page2.status_code == 200:
        leadership_soup2 = BeautifulSoup(leadership_page2.text, 'html.parser')
        leadership_section2 = leadership_soup2.find_all('div', class_='article-block__body')
        for leadership in leadership_section2:
            data2["thought_leadership"].append(leadership.get_text().strip())

    # BCG Market Insights
    market_url2 = "https://www.bcg.com/capabilities/marketing-sales/insights"
    market_page2 = requests.get(market_url2)
    if market_page2.status_code == 200:
        market_soup2 = BeautifulSoup(market_page2.text, 'html.parser')
        market_section2 = market_soup2.find_all('h2', class_='item-title')
        for market in market_section2:
            data2["market_insight"].append(market.get_text().strip())

    print(json.dumps(data2, indent=4, ensure_ascii=False))
    return data2


def style_excel_sheet(sheet):
    sheet.column_dimensions['A'].width = 50

    title_font = Font(bold=True, size=12)
    title_alignment = Alignment(horizontal='center', vertical='center')
    for cell in sheet[1]:
        cell.font = title_font
        cell.alignment = title_alignment


    border = Border(
        left=Side(style='thin'),
        right=Side(style='thin'),
        top=Side(style='thin'),
        bottom=Side(style='thin')
    )
    for row in sheet.iter_rows():
        for cell in row:
            cell.border = border


def save_to_excel(data, filename="bcg_data.xlsx"):
    with pd.ExcelWriter(filename, engine='openpyxl') as writer:
        for category, items in data.items():
            df = pd.DataFrame({category: items})
            df.to_excel(writer, sheet_name=category[:31], index=False)

        metadata = {
            'Last Updated': [pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')],
            'Total Categories': [len(data)],
            'Total Items': [sum(len(v) for v in data.values())]
        }
        pd.DataFrame(metadata).to_excel(writer, sheet_name='Metadata', index=False)

    workbook = writer.book
    for sheet_name in workbook.sheetnames:
        sheet = workbook[sheet_name]
        style_excel_sheet(sheet)

    print(f"Data has been saved to {filename}")


if __name__ == "__main__":
    data = fetch_bcg_data()
    save_to_excel(data)
